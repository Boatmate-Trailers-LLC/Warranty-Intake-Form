<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Warranty Intake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --gap: 0.75rem; }

    body {
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      padding: 2rem;
      background: #f7f7f7;
    }

    h1 {
      margin-bottom: 1rem;
    }

    form {
      max-width: 720px;
      display: grid;
      gap: 1.5rem;
      padding: 1.5rem;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }

    fieldset {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 1rem 1.25rem 1.25rem;
    }

    legend {
      font-weight: 700;
      padding: 0 0.5rem;
    }

    .field-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--gap);
      margin-top: 0.75rem;
    }

    /* 3 columns on wide screens */
    .field-grid--three {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    /* 2 columns on wide screens */
    .field-grid--two {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    /* Optional: make everything stack nicely on small screens */
    @media (max-width: 640px) {
        .field-grid--three,
        .field-grid--two {
        grid-template-columns: 1fr;
        }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .field-wide {
        grid-column: span 2;
    }

    label {
      font-weight: 600;
      font-size: 0.95rem;
    }

    input,
    textarea,
    select,
    button {
      padding: 0.625rem 0.75rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font: inherit;
      box-sizing: border-box;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    input[type="file"] {
      padding: 0.4rem 0.5rem;
    }

    .error {
      color: #b00020;
      font-size: 0.95rem;
    }

    .success {
      color: #0a7d2b;
      font-size: 0.95rem;
    }

    .visually-hidden {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }

    button[type="submit"] {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      background: #1f4f91;
      color: #fff;
      justify-self: flex-start;
    }

    button[type="submit"]:hover {
      filter: brightness(1.05);
    }
  </style>
</head>
<body>

  <h1>Warranty Intake</h1>

  <!-- 
    PRODUCTION FORM
    ---------------
    • 3 sections: Dealer, Customer, Warranty Claim.
    • Posts to Cloudflare Worker endpoint.
    • enctype="multipart/form-data" so file upload works with and without JS.
  -->
  <form
    id="warranty-intake-form"
    method="post"
    action="https://warranty-intake-form.boatmate-trailers-llc.workers.dev/"
    enctype="multipart/form-data"
    novalidate
  >
    <!-- Hidden Category (always "Warranty") -->
    <input type="hidden" id="category" name="category" value="Warranty" />

    <!-- 1) Dealer Information -->
    <fieldset>
      <legend>Dealer Information</legend>
      <div class="field-grid">
        <div class="field field-wide">
          <label for="dealer_name">Dealership</label>
          <input id="dealer_name" name="dealer_name" type="text" required />
        </div>

        <div class="field">
          <label for="dealer_first_name">First Name</label>
          <input id="dealer_first_name" name="dealer_first_name" type="text" required />
        </div>

        <div class="field">
          <label for="dealer_last_name">Last Name</label>
          <input id="dealer_last_name" name="dealer_last_name" type="text" required />
        </div>

        <div class="field field-wide">
          <label for="dealer_address">Address</label>
          <input id="dealer_address" name="dealer_address" type="text" required />
        </div>

        <div class="field">
          <label for="dealer_city">City</label>
          <input id="dealer_city" name="dealer_city" type="text" required />
        </div>

        <div class="field">
          <label for="dealer_region">State/Province/Region</label>
          <input id="dealer_region" name="dealer_region" type="text" required />
        </div>

        <div class="field">
          <label for="dealer_postal_code">Zip/Postal Code</label>
          <input id="dealer_postal_code" name="dealer_postal_code" type="text" required />
        </div>

        <div class="field">
          <label for="dealer_country">Country/Region</label>
          <input id="dealer_country" name="dealer_country" type="text" required />
        </div>

        <div class="field">
          <label for="dealer_phone">Phone</label>
          <input id="dealer_phone" name="dealer_phone" type="tel" required />
        </div>

        <div class="field">
          <label for="dealer_email">Email</label>
          <input id="dealer_email" name="dealer_email" type="email" autocomplete="email" required />
        </div>
      </div>
    </fieldset>

    <!-- 2) Customer Information -->
    <fieldset>
      <legend>Customer Information</legend>
      <div class="field-grid">
        <div class="field">
          <label for="customer_first_name">First Name</label>
          <input id="customer_first_name" name="customer_first_name" type="text" required />
        </div>

        <div class="field">
          <label for="customer_last_name">Last Name</label>
          <input id="customer_last_name" name="customer_last_name" type="text" required />
        </div>

        <div class="field field-wide">
          <label for="customer_address">Address</label>
          <input id="customer_address" name="customer_address" type="text" required />
        </div>

        <div class="field">
          <label for="customer_city">City</label>
          <input id="customer_city" name="customer_city" type="text" required />
        </div>

        <div class="field">
          <label for="customer_region">State/Province/Region</label>
          <input id="customer_region" name="customer_region" type="text" required />
        </div>

        <div class="field">
          <label for="customer_postal_code">Zip/Postal Code</label>
          <input id="customer_postal_code" name="customer_postal_code" type="text" required />
        </div>

        <div class="field">
          <label for="customer_country">Country/Region</label>
          <input id="customer_country" name="customer_country" type="text" required />
        </div>

        <div class="field">
          <label for="customer_phone">Phone</label>
          <input id="customer_phone" name="customer_phone" type="tel" required />
        </div>

        <div class="field">
          <label for="customer_email">Email</label>
          <input id="customer_email" name="customer_email" type="email" autocomplete="email" required />
        </div>
      </div>
    </fieldset>

    <!-- 3) Warranty Claim Information -->
    <fieldset>
        <legend>Warranty Claim Information</legend>

        <!-- Row 1: 3 columns (VIN, Date, Ship To) -->
        <div class="field-grid field-grid--three">
            <div class="field">
                <label for="vin">Trailer VIN</label>
                    <input
                        id="vin"
                        name="vin"
                        type="text"
                        inputmode="latin"
                        autocomplete="on"
                        spellcheck="false"
                        maxlength="17"
                        pattern="[A-HJ-NPR-Z0-9]{17}"
                        required/>
        </div>

        <div class="field">
            <label for="date_of_occurrence">Date of Occurrence</label>
            <input
                id="date_of_occurrence"
                name="date_of_occurrence"
                type="date"
                required/>
        </div>

        <div class="field">
            <label for="ship_to">Ship To</label>
            <select id="ship_to" name="ship_to" required>
                <option value="">Select an option</option>
                <option value="Dealer">Dealer</option>
                <option value="Customer">Customer</option>
            </select>
        </div>
    </div>

    <!-- Row 2: 2 columns (Symptoms, Request) -->
    <div class="field-grid field-grid--two">
        <div class="field">
            <label for="warranty_symptoms">Warranty Symptoms</label>
            <textarea
                id="warranty_symptoms"
                name="warranty_symptoms"
                required>
            </textarea>
        </div>

        <div class="field">
            <label for="warranty_request">Warranty Request</label>
            <textarea
                id="warranty_request"
                name="warranty_request"
                required>
            </textarea>
        </div>
    </div>

    <!-- Row 3: 3 columns (Labor Rate, Labor Hours, Attachments) -->
    <div class="field-grid field-grid--three">
        <div class="field">
            <label for="labor_rate">Warranty Labor Rate</label>
            <input
                id="labor_rate"
                name="labor_rate"
                type="number"
                step="0.01"
                min="0"/>
        </div> 

    <div class="field">
        <label for="labor_hours">Warranty Labor Hours</label>
        <input
            id="labor_hours"
            name="labor_hours"
            type="number"
            step="0.1"
            min="0"/>
    </div>

    <div class="field">
        <label for="attachments">File Upload</label>
        <input
            id="attachments"
            name="attachments"
            type="file"
            multiple
            accept="
                image/*,
                application/pdf,
                application/msword,
                application/vnd.openxmlformats-officedocument.wordprocessingml.document,
                application/vnd.ms-excel,
                application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,
                .pdf,.doc,.docx,.xls,.xlsx"/>
    </div>
  </div>
</fieldset>

    <!-- Live status region -->
    <div id="form-status" role="status" aria-live="polite"></div>

    <!-- Submit button -->
    <button type="submit">Submit Warranty Claim</button>

    <!-- Honeypot anti-bot field -->
    <div class="visually-hidden" aria-hidden="true">
      <label for="website">Leave this field empty</label>
      <input id="website" name="website" type="text" tabindex="-1" autocomplete="off" />
    </div>
  </form>

  <script>
    (function () {
      const form = document.getElementById('warranty-intake-form');
      const statusEl = document.getElementById('form-status');
      const vinInput = document.getElementById('vin');
      const categoryInput = document.getElementById('category');
      const honeypot = document.getElementById('website');

      function setStatus(message, ok = true) {
        statusEl.textContent = message;
        statusEl.className = ok ? 'success' : 'error';
      }

      // Basic VIN format check (not a checksum).
      function validateVIN(vin) {
        const v = vin.toUpperCase().replace(/\s+/g, '');
        const re = /^[A-HJ-NPR-Z0-9]{17}$/;
        return re.test(v);
      }

      async function submitHandler(e) {
        // If fetch isn't available, fall back to normal browser POST.
        if (!window.fetch) return;

        e.preventDefault();

        statusEl.textContent = '';
        statusEl.className = '';

        // Honeypot: if filled, quietly pretend success.
        if (honeypot && honeypot.value) {
          setStatus('Thanks! Your request has been received.', true);
          form.reset();
          if (categoryInput) categoryInput.value = 'Warranty';
          return;
        }

        // Let browser highlight built-in validation issues.
        if (!form.reportValidity()) {
          setStatus('Please correct the highlighted fields before submitting.', false);
          return;
        }

        // VIN normalization + custom message.
        const vinRaw = vinInput.value.trim();
        const normalizedVin = vinRaw.toUpperCase().replace(/\s+/g, '');
        if (!validateVIN(normalizedVin)) {
          setStatus('Please enter a valid VIN (17 characters; letters I, O, Q are not used).', false);
          vinInput.focus();
          return;
        }
        // Store normalized VIN back into the field so the server gets it.
        vinInput.value = normalizedVin;

        // Ensure category is still set.
        if (categoryInput && !categoryInput.value) {
          categoryInput.value = 'Warranty';
        }

        // Use FormData so file uploads are included.
        const formData = new FormData(form);

        try {
          const res = await fetch(form.action, {
            method: 'POST',
            body: formData
          });

          const data = await res.json().catch(() => ({}));

          if (res.ok && data.ok !== false) {
            setStatus(data.message || 'Submitted. Check your email for confirmation.');
            form.reset();
            if (categoryInput) categoryInput.value = 'Warranty';
          } else {
            const msg = data.message || `Submission failed (${res.status}). Please try again.`;
            setStatus(msg, false);
          }
        } catch (err) {
          setStatus('Network error. Please try again in a moment.', false);
        }
      }

      form.addEventListener('submit', submitHandler);
    })();
  </script>
</body>
</html>
